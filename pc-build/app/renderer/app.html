<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash Royale OCR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #050511;
            --bg-secondary: #0a0a1f;
            --bg-card: rgba(15, 15, 35, 0.8);
            --border-color: rgba(139, 92, 246, 0.1);
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b8;
            --accent-purple: #8B5CF6;
            --accent-blue: #3B82F6;
            --accent-pink: #EC4899;
            --success: #10B981;
            --error: #EF4444;
            --warning: #8B5CF6;
            --glass: rgba(255, 255, 255, 0.02);
            --shadow-glow: 0 0 40px rgba(139, 92, 246, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω */
        .animated-bg {
            position: fixed;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            z-index: -1;
            animation: aurora 20s ease-in-out infinite;
            background: 
                radial-gradient(ellipse at 20% 0%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 100%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 0% 100%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
                var(--bg-primary);
        }

        @keyframes aurora {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(1); }
            75% { transform: rotate(270deg) scale(1.1); }
        }

        /* –ß–∞—Å—Ç–∏—Ü—ã */
        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--accent-purple);
            border-radius: 50%;
            opacity: 0;
            animation: float-particle 10s infinite;
        }

        @keyframes float-particle {
            0% {
                opacity: 0;
                transform: translateY(100vh) scale(0);
            }
            10% {
                opacity: 1;
                transform: translateY(90vh) scale(1);
            }
            90% {
                opacity: 1;
                transform: translateY(10vh) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(0) scale(0);
            }
        }

        /* –ù–µ–æ–º–æ—Ä—Ñ–Ω—ã–π header */
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 
                0 4px 24px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            z-index: 100;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-purple), 
                var(--accent-blue), 
                var(--accent-pink), 
                transparent
            );
            opacity: 0.5;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-title h1 {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
            letter-spacing: -0.5px;
        }

        /* –ü—É–ª—å—Å–∏—Ä—É—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--error);
            position: relative;
            box-shadow: 0 0 20px currentColor;
        }

        .status-indicator::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            animation: pulse-ring 2s ease-out infinite;
        }

        .status-indicator.active {
            background: var(--success);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px currentColor, 0 0 40px currentColor;
            }
            50% {
                box-shadow: 0 0 30px currentColor, 0 0 60px currentColor;
            }
        }

        /* User info —Å glassmorphism */
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            background: var(--glass);
            padding: 10px 20px;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .user-name {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .logout-btn {
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--error), #DC2626);
            border: none;
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .logout-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
        }

        .logout-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        /* Main content —Å glass sidebar */
        .main-content {
            display: flex;
            height: calc(100vh - 80px);
            position: relative;
        }

        /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π sidebar */
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, 
                rgba(15, 15, 35, 0.9) 0%, 
                rgba(10, 10, 31, 0.9) 100%
            );
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            padding: 30px 20px;
            overflow-y: auto;
            position: relative;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            right: -1px;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, 
                transparent, 
                var(--accent-purple), 
                var(--accent-blue), 
                transparent
            );
            opacity: 0.5;
        }

        .control-section {
            margin-bottom: 30px;
            background: var(--glass);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .control-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.2);
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –ù–µ–æ–º–æ—Ä—Ñ–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .button {
            width: 100%;
            padding: 14px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 
                0 4px 15px rgba(139, 92, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translate(-50%, -50%) rotate(45deg) translateX(-100%);
            transition: transform 0.6s;
        }

        .button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 25px rgba(139, 92, 246, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .button:hover::after {
            transform: translate(-50%, -50%) rotate(45deg) translateX(100%);
        }

        .button:active {
            transform: translateY(-1px) scale(1);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button.secondary {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .button.danger {
            background: linear-gradient(135deg, var(--error), #DC2626);
            box-shadow: 
                0 4px 15px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –Ω–µ–æ–º–æ—Ä—Ñ–∏–∑–º–æ–º */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 
                inset 2px 2px 5px rgba(0, 0, 0, 0.5),
                inset -2px -2px 5px rgba(255, 255, 255, 0.02);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-purple), transparent);
            animation: scan 3s ease-in-out infinite;
        }

        @keyframes scan {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: rgba(139, 92, 246, 0.3);
            box-shadow: 
                0 8px 25px rgba(139, 92, 246, 0.2),
                inset 2px 2px 5px rgba(0, 0, 0, 0.5),
                inset -2px -2px 5px rgba(255, 255, 255, 0.02);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Mode toggle —Å –Ω–µ–æ–º–æ—Ä—Ñ–∏–∑–º–æ–º */
        .mode-toggle-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 10px;
            box-shadow: 
                inset 2px 2px 5px rgba(0, 0, 0, 0.5),
                inset -2px -2px 5px rgba(255, 255, 255, 0.02);
        }

        .mode-indicator {
            font-size: 14px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mode-toggle {
            position: relative;
            display: block;
            width: 70px;
            height: 35px;
            margin: 0 auto 15px auto;
        }

        .mode-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .mode-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 35px;
            border: 2px solid var(--border-color);
            box-shadow: 
                inset 2px 2px 5px rgba(0, 0, 0, 0.5),
                inset -2px -2px 5px rgba(255, 255, 255, 0.02);
        }

        .mode-slider:before {
            position: absolute;
            content: "";
            height: 25px;
            width: 25px;
            left: 3px;
            bottom: 3px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            box-shadow: 
                0 4px 15px rgba(139, 92, 246, 0.5),
                0 0 20px rgba(139, 92, 246, 0.3);
        }

        input:checked + .mode-slider {
            border-color: rgba(236, 72, 153, 0.5);
        }

        input:checked + .mode-slider:before {
            transform: translateX(35px);
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
            box-shadow: 
                0 4px 15px rgba(236, 72, 153, 0.5),
                0 0 20px rgba(236, 72, 153, 0.3);
        }

        .mode-description {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.4;
        }
        
        /* üåê –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏ */
        .server-toggle-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 10px;
            box-shadow: 
                inset 2px 2px 5px rgba(0, 0, 0, 0.5),
                inset -2px -2px 5px rgba(255, 255, 255, 0.02);
        }
        
        .server-status {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .server-mode {
            font-size: 18px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .connection-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--error);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px currentColor;
            animation: pulse-dot 2s ease-in-out infinite;
        }
        
        .indicator-dot.connected {
            background: var(--success);
            animation: none;
        }
        
        .indicator-dot.backup {
            background: var(--warning);
            animation: pulse-warning 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }
        
        @keyframes pulse-warning {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
                box-shadow: 0 0 10px var(--warning);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.3);
                box-shadow: 0 0 20px var(--warning);
            }
        }
        
        .server-switch-buttons {
            display: flex;
            gap: 10px;
        }
        
        .server-btn {
            flex: 1;
            padding: 12px 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 
                inset 1px 1px 3px rgba(0, 0, 0, 0.5),
                inset -1px -1px 3px rgba(255, 255, 255, 0.02);
        }
        
        .server-btn:hover {
            transform: translateY(-2px);
            border-color: rgba(139, 92, 246, 0.3);
            color: var(--text-primary);
            box-shadow: 
                0 4px 15px rgba(139, 92, 246, 0.2),
                inset 1px 1px 3px rgba(0, 0, 0, 0.5),
                inset -1px -1px 3px rgba(255, 255, 255, 0.02);
        }
        
        .server-btn.active {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            border-color: transparent;
            color: white;
            transform: translateY(-1px);
            box-shadow: 
                0 6px 20px rgba(139, 92, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .server-btn.active:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(139, 92, 246, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .server-btn.test.active {
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
            box-shadow: 
                0 6px 20px rgba(236, 72, 153, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .server-btn.test.active:hover {
            box-shadow: 
                0 8px 25px rgba(236, 72, 153, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .server-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .server-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translate(-50%, -50%) rotate(45deg) translateX(-100%);
            transition: transform 0.6s;
        }
        
        .server-btn:hover::after {
            transform: translate(-50%, -50%) rotate(45deg) translateX(100%);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ */
        .server-switching {
            position: relative;
        }
        
        .server-switching::before {
            content: 'üîÑ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            animation: spin 1s linear infinite;
            background: rgba(0, 0, 0, 0.8);
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            backdrop-filter: blur(5px);
        }

        /* Content area —Å glass —ç—Ñ—Ñ–µ–∫—Ç–æ–º */
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: var(--glass);
            position: relative;
        }

        .content-header {
            margin-bottom: 30px;
            animation: slideInDown 0.5s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .content-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .content-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* Results grid —Å stagger –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å 3D —ç—Ñ—Ñ–µ–∫—Ç–æ–º */
        .result-card {
            background: linear-gradient(135deg, 
                rgba(20, 20, 35, 0.9), 
                rgba(15, 15, 30, 0.9)
            );
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(
                circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
                rgba(139, 92, 246, 0.1) 0%,
                transparent 50%
            );
            opacity: 0;
            transition: opacity 0.3s;
        }

        .result-card:hover::before {
            opacity: 1;
        }

        .result-card:hover {
            transform: translateY(-5px) rotateX(2deg);
            box-shadow: 
                0 20px 60px rgba(139, 92, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .player-name {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .player-trophies {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            color: var(--warning);
            font-weight: 700;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .rating-icon {
            width: 20px;
            height: 20px;
            object-fit: contain;
            vertical-align: middle;
        }

        .player-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .detail-item {
            background: var(--bg-primary);
            padding: 12px;
            border-radius: 12px;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            box-shadow: 
                inset 1px 1px 3px rgba(0, 0, 0, 0.5),
                inset -1px -1px 3px rgba(255, 255, 255, 0.02);
        }

        .detail-item:hover {
            border-color: rgba(139, 92, 246, 0.2);
            transform: translateY(-1px);
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .detail-value {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 15px;
        }

        /* Deck display —Å hover —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ */
        .deck-cards-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .deck-card-item {
            position: relative;
            background: var(--bg-primary);
            border-radius: 8px;
            aspect-ratio: 0.8;
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .deck-card-item:hover {
            transform: translateY(-5px) scale(1.1);
            z-index: 10;
            box-shadow: 
                0 10px 30px rgba(139, 92, 246, 0.4),
                0 0 40px rgba(139, 92, 246, 0.2);
            border-color: var(--accent-purple);
        }

        .deck-card-item.evolution {
            background: linear-gradient(135deg, 
                rgba(236, 72, 153, 0.2), 
                rgba(139, 92, 246, 0.1)
            );
            box-shadow: 
                0 4px 20px rgba(236, 72, 153, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .deck-card-item.evolution:hover {
            transform: translateY(-8px) scale(1.15) rotateZ(5deg);
            box-shadow: 
                0 15px 40px rgba(236, 72, 153, 0.6),
                0 0 60px rgba(236, 72, 153, 0.3);
        }

        .evolution-indicator {
            position: absolute;
            top: 4px;
            right: 4px;
            font-size: 10px;
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            box-shadow: 0 2px 10px rgba(236, 72, 153, 0.5);
            animation: pulse-evo 2s ease-in-out infinite;
        }

        @keyframes pulse-evo {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 10px rgba(236, 72, 153, 0.5);
            }
            50% {
                transform: scale(1.2);
                box-shadow: 0 4px 20px rgba(236, 72, 153, 0.8);
            }
        }

        .deck-card-item img {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            object-fit: cover;
            transition: transform 0.3s ease;
            filter: brightness(0.9);
        }

        .deck-card-item:hover img {
            transform: scale(1.1);
            filter: brightness(1.1);
        }

        .timestamp {
            text-align: right;
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 15px;
            opacity: 0.7;
        }

        /* Empty state —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.2;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .empty-title {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 700;
        }

        .empty-text {
            color: var(--text-secondary);
            font-size: 16px;
            opacity: 0.7;
        }

        /* Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .status-message {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 18px 25px;
            background: linear-gradient(135deg, 
                rgba(20, 20, 35, 0.95), 
                rgba(15, 15, 30, 0.95)
            );
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .status-message.success {
            border-color: rgba(16, 185, 129, 0.3);
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.1), 
                rgba(16, 185, 129, 0.05)
            );
            box-shadow: 
                0 10px 40px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .status-message.error {
            border-color: rgba(239, 68, 68, 0.3);
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.1), 
                rgba(239, 68, 68, 0.05)
            );
            box-shadow: 
                0 10px 40px rgba(239, 68, 68, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Loading overlay —Å blur */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 17, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(139, 92, 246, 0.1);
            border-top: 3px solid var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            box-shadow: 0 0 40px rgba(139, 92, 246, 0.5);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        .test-mode-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent,
                var(--accent-pink),
                var(--warning),
                var(--accent-pink),
                transparent
            );
            z-index: 10000;
            animation: test-mode-glow 2s ease-in-out infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .test-mode-indicator.active {
            opacity: 1;
        }
        
        @keyframes test-mode-glow {
            0%, 100% {
                opacity: 0.5;
                transform: scaleX(1);
            }
            50% {
                opacity: 1;
                transform: scaleX(1.02);
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--accent-purple), var(--accent-blue));
            border-radius: 10px;
            border: 2px solid var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--accent-pink), var(--accent-purple));
        }

        /* –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ */
        .widget-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 
                0 10px 30px rgba(139, 92, 246, 0.5),
                0 0 40px rgba(139, 92, 246, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: float-button 3s ease-in-out infinite;
        }

        @keyframes float-button {
            0%, 100% {
                transform: translateY(0) scale(1);
                box-shadow: 
                    0 10px 30px rgba(139, 92, 246, 0.5),
                    0 0 40px rgba(139, 92, 246, 0.3);
            }
            50% {
                transform: translateY(-5px) scale(1.05);
                box-shadow: 
                    0 15px 40px rgba(139, 92, 246, 0.6),
                    0 0 60px rgba(139, 92, 246, 0.4);
            }
        }

        .widget-button:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 
                0 15px 50px rgba(236, 72, 153, 0.6),
                0 0 60px rgba(236, 72, 153, 0.4);
        }

        .widget-button:active {
            transform: scale(0.95);
        }

        /* üöÄ –ü—Ä–µ–º–∏—É–º —Å—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π */
        .update-section {
            position: relative;
            overflow: hidden;
        }

        .update-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                var(--accent-purple), 
                var(--accent-blue), 
                var(--accent-pink), 
                var(--accent-purple)
            );
            background-size: 400% 400%;
            border-radius: 22px;
            z-index: -1;
            animation: gradient-border 4s ease infinite;
            opacity: 0.7;
        }

        @keyframes gradient-border {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .update-container {
            background: var(--bg-primary);
            border-radius: 15px;
            padding: 18px;
            margin: -3px;
            position: relative;
            z-index: 1;
        }

        .current-version {
            text-align: center;
            margin-bottom: 15px;
            padding: 12px;
            background: linear-gradient(135deg, 
                rgba(139, 92, 246, 0.1), 
                rgba(59, 130, 246, 0.05)
            );
            border-radius: 12px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .version-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .version-value {
            font-size: 18px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .update-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: var(--glass);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .status-icon {
            font-size: 16px;
            width: 24px;
            text-align: center;
            animation: pulse-icon 2s ease-in-out infinite;
        }

        @keyframes pulse-icon {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .status-text {
            flex: 1;
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .update-button {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, 
                var(--accent-purple), 
                var(--accent-blue),
                var(--accent-pink)
            );
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
            margin-bottom: 15px;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .update-button:hover {
            animation-duration: 1s;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 25px rgba(139, 92, 246, 0.5),
                0 0 40px rgba(139, 92, 246, 0.3);
        }

        .update-button:disabled {
            background: var(--bg-secondary);
            animation: none;
            opacity: 0.6;
            cursor: not-allowed;
        }

        .update-button .button-icon {
            display: inline-block;
            margin-right: 8px;
            transition: transform 0.3s ease;
        }

        .update-button:hover .button-icon {
            transform: rotate(180deg);
        }

        .update-button:disabled .button-icon {
            animation: spin 1s linear infinite;
        }

        .update-info {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.1), 
                rgba(59, 130, 246, 0.05)
            );
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            padding: 15px;
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .new-version {
            font-size: 16px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .new-version::before {
            content: '‚ú®';
            animation: sparkle 1.5s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        .release-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π */
        .update-status.checking {
            border-color: rgba(139, 92, 246, 0.3);
            background: linear-gradient(135deg, 
                rgba(139, 92, 246, 0.1), 
                rgba(59, 130, 246, 0.05)
            );
        }

        .update-status.checking .status-icon {
            animation: spin 1s linear infinite;
        }

        .update-status.available {
            border-color: rgba(16, 185, 129, 0.3);
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.1), 
                rgba(34, 197, 94, 0.05)
            );
        }

        .update-status.available .status-icon {
            animation: bounce 1s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .update-status.up-to-date {
            border-color: rgba(34, 197, 94, 0.3);
            background: linear-gradient(135deg, 
                rgba(34, 197, 94, 0.1), 
                rgba(16, 185, 129, 0.05)
            );
        }

        .update-status.error {
            border-color: rgba(239, 68, 68, 0.3);
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.1), 
                rgba(220, 38, 38, 0.05)
            );
        }

        .update-status.downloading {
            border-color: rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.1), 
                rgba(139, 92, 246, 0.05)
            );
        }

        .update-status.downloading .status-icon {
            animation: pulse-download 1.5s ease-in-out infinite;
        }

        @keyframes pulse-download {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }

        .update-status.downloaded {
            border-color: rgba(16, 185, 129, 0.3);
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.1), 
                rgba(34, 197, 94, 0.05)
            );
        }

        .update-status.downloaded .status-icon {
            animation: success-glow 2s ease-in-out infinite;
        }

        @keyframes success-glow {
            0%, 100% {
                transform: scale(1);
                text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
            }
            50% {
                transform: scale(1.1);
                text-shadow: 0 0 20px rgba(16, 185, 129, 0.8);
            }
        }

        .update-status.error .status-icon {
            animation: shake 0.5s ease-in-out infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è */
        .download-button {
            background: linear-gradient(135deg, var(--success), #059669);
            margin-top: 10px;
            animation: glow-green 2s ease-in-out infinite;
        }

        .download-button:hover {
            background: linear-gradient(135deg, #059669, var(--success));
            box-shadow: 
                0 8px 25px rgba(16, 185, 129, 0.5),
                0 0 40px rgba(16, 185, 129, 0.3);
        }

        @keyframes glow-green {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            }
            50% {
                box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
            }
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
        .update-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 17, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .update-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .update-modal-content {
            background: linear-gradient(135deg, 
                rgba(20, 20, 35, 0.95), 
                rgba(15, 15, 30, 0.95)
            );
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .update-modal.active .update-modal-content {
            transform: scale(1);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .modal-version {
            font-size: 20px;
            color: var(--success);
            font-weight: 700;
            margin-bottom: 20px;
        }

        .modal-description {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-button {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .modal-button.primary {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .modal-button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
        }

        .modal-button.secondary {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .modal-button.secondary:hover {
            border-color: rgba(139, 92, 246, 0.3);
            color: var(--text-primary);
        }

        /* –°–µ–ª–µ–∫—Ü–∏—è */
        ::selection {
            background: rgba(139, 92, 246, 0.3);
            color: var(--text-primary);
        }

        /* üÜï –≠–¢–ê–ü 3.1: –°—Ç–∏–ª–∏ –¥–∏–∞–ª–æ–≥–∞ –≤—ã–±–æ—Ä–∞ –æ–∫–Ω–∞ */
        .window-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .window-dialog {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.3s ease;
        }

        .window-dialog-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            color: white;
        }

        .window-dialog-header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .close-button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .close-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .window-dialog-content {
            padding: 24px;
            overflow-y: auto;
            max-height: 60vh;
        }

        .mode-selection {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .mode-option {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }

        .mode-option:hover {
            border-color: var(--accent-purple);
            background: rgba(139, 92, 246, 0.1);
        }

        .mode-option.active {
            border-color: var(--accent-purple);
            background: rgba(139, 92, 246, 0.2);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .mode-icon {
            font-size: 32px;
            margin-right: 16px;
        }

        .mode-info h3 {
            margin: 0 0 4px 0;
            font-size: 16px;
            color: var(--text-primary);
        }

        .mode-info p {
            margin: 0;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .window-list-container {
            position: relative;
            min-height: 200px;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        .windows-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .window-item {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            position: relative;
        }

        .window-item:hover {
            border-color: var(--accent-blue);
            background: rgba(59, 130, 246, 0.1);
        }

        .window-item.selected {
            border-color: var(--accent-purple);
            background: rgba(139, 92, 246, 0.2);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .window-thumbnail {
            width: 100%;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            margin-bottom: 12px;
        }

        .window-info h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .window-info p {
            margin: 0;
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .window-selected-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--accent-purple);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .window-item.selected .window-selected-indicator {
            opacity: 1;
        }

        .windows-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--text-secondary);
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--error);
        }

        .window-dialog-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--bg-secondary);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="test-mode-indicator" id="test-mode-indicator"></div>
    <div class="animated-bg"></div>
    <div class="particles" id="particles"></div>

    <header class="header">
        <div class="header-title">
            <h1>Clash Royale OCR</h1>
            <span class="status-indicator" id="status-indicator"></span>
        </div>
        <div class="user-info">
            <span class="user-name" id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
    </header>

    <div class="main-content">
        <aside class="sidebar">
            <!-- üåê –ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏ -->
            <div class="control-section">
                <h3 class="section-title">üåê –°–µ—Ä–≤–µ—Ä</h3>
                <div class="server-toggle-container">
                    <div class="server-status" id="server-status">
                        <div class="server-mode" id="server-mode">Global</div>
                        <div class="connection-indicator" id="connection-indicator">
                            <span class="indicator-dot"></span>
                            <span class="indicator-text">Connecting...</span>
                        </div>
                    </div>
                    <div class="server-switch-buttons">
                        <button class="server-btn active" id="global-btn" onclick="switchToServer('global')">
                            üåç Global
                        </button>
                        <button class="server-btn" id="test-btn" onclick="switchToServer('test')">
                            üß™ Test
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="control-section">
                <h3 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º</h3>
                <button class="button" id="start-monitor" onclick="startMonitoring()">
                    ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                </button>
                <button class="button danger" id="stop-monitor" onclick="stopMonitoring()" disabled>
                    ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                </button>
            </div>

            <div class="control-section">
                <h3 class="section-title">–†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞</h3>
                <div class="mode-toggle-container">
                    <div class="mode-indicator" id="mode-indicator">–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º</div>
                    <label class="mode-toggle">
                        <input type="checkbox" id="search-mode-toggle" onchange="toggleSearchMode()">
                        <span class="mode-slider"></span>
                    </label>
                    <div class="mode-description" id="mode-description">
                        –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3 class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <button class="button secondary" onclick="showWindowSelectionDialog()">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±–ª–∞—Å—Ç–∏ OCR
                </button>
                
                <!-- üéØ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ -->
                <div class="advanced-settings" style="margin-top: 15px; padding: 15px; background: var(--bg-card); border-radius: 8px; border: 1px solid var(--border-color);">
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <h4 style="margin: 0; color: var(--text-primary); font-size: 14px;">‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
                        <button id="toggle-advanced" onclick="toggleAdvancedSettings()" style="margin-left: auto; background: none; border: none; color: var(--accent-purple); cursor: pointer; font-size: 16px;">‚ñº</button>
                    </div>
                    
                    <div id="advanced-content" style="display: none;">
                        <div style="margin-bottom: 12px;">
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ —Ç–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (—Å–µ–∫):</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="preciseDelaySlider" min="0" max="5" step="0.1" value="2.2" 
                                       style="flex: 1; height: 4px; background: var(--bg-secondary); border-radius: 2px; outline: none; appearance: none;"
                                       onchange="updatePreciseDelay(this.value)">
                                <span id="preciseDelayValue" style="font-size: 12px; color: var(--accent-purple); min-width: 40px;">2.2—Å</span>
                            </div>
                            <small style="color: var(--text-secondary); font-size: 10px;">–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞–Ω–µ</small>
                        </div>
                        
                        <div style="margin-bottom: 12px;">
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">üîÑ Cooldown –º–µ–∂–¥—É –ø–æ–∏—Å–∫–∞–º–∏ (—Å–µ–∫):</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="cooldownSlider" min="5" max="60" step="1" value="15"
                                       style="flex: 1; height: 4px; background: var(--bg-secondary); border-radius: 2px; outline: none; appearance: none;"
                                       onchange="updateCooldown(this.value)">
                                <span id="cooldownValue" style="font-size: 12px; color: var(--accent-blue); min-width: 40px;">15—Å</span>
                            </div>
                            <small style="color: var(--text-secondary); font-size: 10px;">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è–º–∏</small>
                        </div>
                        
                        <div style="margin-bottom: 12px;">
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">üéØ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è:</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="confirmationsSlider" min="1" max="5" step="1" value="2"
                                       style="flex: 1; height: 4px; background: var(--bg-secondary); border-radius: 2px; outline: none; appearance: none;"
                                       onchange="updateConfirmations(this.value)">
                                <span id="confirmationsValue" style="font-size: 12px; color: var(--accent-pink); min-width: 40px;">2</span>
                            </div>
                            <small style="color: var(--text-secondary); font-size: 10px;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</small>
                        </div>
                        
                        <!-- üñºÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫—Ä—ã—Ç–∏—è —Ä–∞–º–∫–∏ –∑–∞—Ö–≤–∞—Ç–∞ -->
                        <div style="margin-bottom: 12px;">
                            <label style="display: flex; align-items: center; cursor: pointer; font-size: 12px; color: var(--text-secondary);">
                                <input type="checkbox" id="hideBorderCheckbox" style="margin-right: 8px; accent-color: var(--accent-purple);" onchange="updateHideBorder(this.checked)">
                                üñºÔ∏è –°–∫—Ä—ã—Ç—å —Ä–∞–º–∫—É –∑–∞—Ö–≤–∞—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö Windows)
                            </label>
                            <small style="color: var(--text-secondary); font-size: 10px;">–£–±–∏—Ä–∞–µ—Ç –æ—Ä–∞–Ω–∂–µ–≤—É—é —Ä–∞–º–∫—É –≤–æ–∫—Ä—É–≥ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º–æ–≥–æ –æ–∫–Ω–∞</small>
                        </div>
                        
                        <button onclick="resetToDefaults()" style="width: 100%; padding: 8px; background: var(--bg-secondary); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; font-size: 11px;">
                            üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —Å—Ç—Ä–∏–º–µ—Ä–∞ -->
            <div class="control-section streamer-section">
                <h3 class="section-title">–°—Ç—Ä–∏–º–µ—Ä—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
                <button class="button secondary streamer-button" onclick="handleStreamerClick()" style="width: 100%; margin-bottom: 10px;">
                    –ü–∞–Ω–µ–ª—å —Å—Ç—Ä–∏–º–µ—Ä–∞
                </button>
                <div style="font-size: 11px; color: var(--text-secondary); text-align: center; line-height: 1.3;">
                    –ê–≤—Ç–æ–ø—Ä–æ–≥–Ω–æ–∑—ã Twitch ‚Ä¢ –û–≤–µ—Ä–ª–µ–∏ ‚Ä¢ –ê–ª–µ—Ä—Ç—ã
                </div>
            </div>

            <!-- üöÄ –°–µ–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–µ–º–∏—É–º-–∫–ª–∞—Å—Å–∞ -->
            <div class="control-section update-section">
                <h3 class="section-title">üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è</h3>
                <div class="update-container">
                    <div class="current-version" id="current-version">
                        <div class="version-label">–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è</div>
                        <div class="version-value" id="version-display">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                    <div class="update-status" id="update-status">
                        <div class="status-icon" id="status-icon">‚è≥</div>
                        <div class="status-text" id="status-text">–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ</div>
                    </div>
                    <button class="button update-button" id="check-update-btn" onclick="checkForUpdates()">
                        <span class="button-icon">üîÑ</span>
                        <span class="button-text">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</span>
                    </button>
                    <div class="update-info" id="update-info" style="display: none;">
                        <div class="new-version" id="new-version"></div>
                        <div class="release-date" id="release-date"></div>
                        <div class="file-size" id="file-size"></div>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–∏</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="battles-count">0</div>
                        <div class="stat-label">–ë–æ—ë–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="success-rate">0%</div>
                        <div class="stat-label">–£—Å–ø–µ—Ö</div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="content">
            <div class="content-header">
                <h2 class="content-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
                <p class="content-subtitle">–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</p>
            </div>

            <div id="results-container" class="results-grid">
                <div class="empty-state">
                    <div class="empty-icon">üéÆ</div>
                    <h3 class="empty-title">–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
                    <p class="empty-text">–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É</p>
                </div>
            </div>
        </main>
    </div>

    <button class="widget-button" id="widget-button" onclick="toggleDeckWidget()" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–∂–µ—Ç –∫–æ–ª–æ–¥—ã">
        üÉè
    </button>

    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        let isMonitoring = false;
        let battlesCount = 0;
        let successCount = 0;
        let currentUser = null;
        let lastPlayerData = null;
        let searchMode = 'fast';
        let currentServerMode = 'global';
        let serverSwitching = false;

        // –°–æ–∑–¥–∞—ë–º —á–∞—Å—Ç–∏—Ü—ã
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = 10 + Math.random() * 10 + 's';
                container.appendChild(particle);
            }
        }
        createParticles();

        // –≠—Ñ—Ñ–µ–∫—Ç —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –º—ã—à–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫
        document.addEventListener('mousemove', (e) => {
            document.querySelectorAll('.result-card').forEach(card => {
                const rect = card.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                card.style.setProperty('--mouse-x', x + '%');
                card.style.setProperty('--mouse-y', y + '%');
            });
        });

        // üåê –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏
        async function switchToServer(mode) {
            if (serverSwitching || currentServerMode === mode) {
                return;
            }
            
            serverSwitching = true;
            updateServerUI(mode, 'switching');
            showStatus(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ ${mode === 'global' ? 'Global' : 'Test'} —Å–µ—Ä–≤–µ—Ä...`, 'info');
            
            try {
                const result = await window.electronAPI.server.switch(mode);
                
                if (result.success) {
                    currentServerMode = mode;
                    updateServerUI(mode, 'connected', result.server?.isBackup);
                    updateTestModeIndicator(mode === 'test');
                    
                    const serverName = mode === 'global' ? 'üåç Global' : 'üß™ Test';
                    const statusText = result.server?.isBackup ? ' (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)' : '';
                    showStatus(`–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ ${serverName}${statusText}`, 'success');
                } else {
                    updateServerUI(currentServerMode, 'error');
                    showStatus(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è: ${result.error}`, 'error');
                }
            } catch (error) {
                updateServerUI(currentServerMode, 'error');
                showStatus(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            } finally {
                serverSwitching = false;
            }
        }
        
        function updateServerUI(mode, status = 'connecting', isBackup = false) {
            const serverModeEl = document.getElementById('server-mode');
            const connectionIndicator = document.getElementById('connection-indicator');
            const indicatorDot = connectionIndicator.querySelector('.indicator-dot');
            const indicatorText = connectionIndicator.querySelector('.indicator-text');
            const globalBtn = document.getElementById('global-btn');
            const testBtn = document.getElementById('test-btn');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞
            serverModeEl.textContent = mode === 'global' ? 'Global Server' : 'Test Server';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            globalBtn.classList.toggle('active', mode === 'global');
            testBtn.classList.toggle('active', mode === 'test');
            testBtn.classList.toggle('test', true); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å test –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
            indicatorDot.className = 'indicator-dot';
            
            switch (status) {
                case 'connected':
                    if (isBackup) {
                        indicatorDot.classList.add('backup');
                        indicatorText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)';
                    } else {
                        indicatorDot.classList.add('connected');
                        indicatorText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω';
                    }
                    break;
                case 'switching':
                    indicatorText.textContent = '–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ...';
                    globalBtn.classList.add('server-switching');
                    testBtn.classList.add('server-switching');
                    setTimeout(() => {
                        globalBtn.classList.remove('server-switching');
                        testBtn.classList.remove('server-switching');
                    }, 2000);
                    break;
                case 'error':
                    indicatorText.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                    break;
                default:
                    indicatorText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            }
        }
        
        function updateTestModeIndicator(isTestMode) {
            const indicator = document.getElementById('test-mode-indicator');
            indicator.classList.toggle('active', isTestMode);
        }
        
        async function checkServerConnection() {
            try {
                const result = await window.electronAPI.server.check();
                if (result.available) {
                    updateServerUI(currentServerMode, 'connected');
                } else {
                    updateServerUI(currentServerMode, 'error');
                }
            } catch (error) {
                updateServerUI(currentServerMode, 'error');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.electronAPI.on('user-data', (data) => {
            if (data.user) {
                currentUser = data.user;
                document.getElementById('user-name').textContent = data.user.username || data.user.email;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ–º searchMode, –¥–∞–∂–µ –µ—Å–ª–∏ null (–±—É–¥–µ—Ç 'fast' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            if (data.searchMode !== undefined) {
                searchMode = data.searchMode || 'fast';
                updateModeUI();
            }
            
            if (data.server) {
                currentServerMode = data.server.mode;
                updateServerUI(data.server.mode, data.server.available ? 'connected' : 'error');
                updateTestModeIndicator(data.server.mode === 'test');
            }
            
            if (data.regions && data.regions.trigger_area && data.regions.normal_data_area) {
                showStatus('–û–±–ª–∞—Å—Ç–∏ OCR –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã', 'success');
            } else {
                showStatus('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±–ª–∞—Å—Ç–∏ OCR', 'error');
            }
        });

        // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π Python
        window.electronAPI.on('python-status', (status) => {
            showStatus(status, 'success');
        });

        window.electronAPI.on('player-found', (playerData) => {
            console.log('–ò–≥—Ä–æ–∫ –Ω–∞–π–¥–µ–Ω:', playerData);
            lastPlayerData = playerData;
            battlesCount++;
            successCount++;
            updateStats();
            addResultCard(playerData);
        });

        window.electronAPI.on('ocr_reprocessed', (reprocessData) => {
            console.log(' –ø–æ–ª—É—á–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', reprocessData);
            showStatus('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!', 'success');
            
            // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞
            lastPlayerData = reprocessData.data;

            // –†–∏—Å—É–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            addResultCard(reprocessData.data); 
        });

        window.electronAPI.on('python-error', (error) => {
            showStatus(`–û—à–∏–±–∫–∞: ${error}`, 'error');
        });

        window.electronAPI.on('python-stopped', () => {
            isMonitoring = false;
            updateMonitoringUI();
            showStatus('–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'error');
        });

        window.electronAPI.on('regions-updated', (regions) => {
            showStatus('–û–±–ª–∞—Å—Ç–∏ OCR –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        });
        
        // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π —Å–µ—Ä–≤–µ—Ä–∞
        window.electronAPI.on('server-changed', (serverInfo) => {
            currentServerMode = serverInfo.mode;
            updateServerUI(serverInfo.mode, serverInfo.available ? 'connected' : 'error', serverInfo.isBackup);
            updateTestModeIndicator(serverInfo.mode === 'test');
        });
        
        window.electronAPI.on('server-switching', (data) => {
            updateServerUI(data.mode, 'switching');
        });
        
        window.electronAPI.on('server-status', (serverInfo) => {
            updateServerUI(serverInfo.mode, serverInfo.available ? 'connected' : 'error');
        });

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        async function startMonitoring() {
            showLoading(true);
            const result = await window.electronAPI.monitor.start();
            showLoading(false);
            
            if (result.success) {
                isMonitoring = true;
                updateMonitoringUI();
                showStatus('–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω', 'success');
            } else {
                showStatus('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥', 'error');
            }
        }

        async function stopMonitoring() {
            const result = await window.electronAPI.monitor.stop();
            if (result.success) {
                isMonitoring = false;
                updateMonitoringUI();
            }
        }

        async function setupRegions() {
            await window.electronAPI.ocr.setupRegions();
        }

        // üéÆ –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ —Å—Ç—Ä–∏–º–µ—Ä–∞
        async function handleStreamerClick() {
            console.log('üéØ –ù–û–í–´–ô –ö–õ–ò–ö –û–ë–†–ê–ë–û–¢–ß–ò–ö - –§–£–ù–ö–¶–ò–Ø –ó–ê–ü–£–©–ï–ù–ê!');
            
            try {
                if (window.electronAPI && window.electronAPI.tokens) {
                    console.log('üîë –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ ElectronAPI...');
                    const result = await window.electronAPI.tokens.getUser();
                    
                    if (result.success && result.tokens) {
                        console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º...');
                        
                        // –°–ø–æ—Å–æ–± 1: localStorage
                        localStorage.setItem('auth_tokens', JSON.stringify(result.tokens));
                        localStorage.setItem('tokens', JSON.stringify(result.tokens));
                        localStorage.setItem('streamer_tokens', JSON.stringify(result.tokens));
                        
                        // –°–ø–æ—Å–æ–± 2: sessionStorage
                        sessionStorage.setItem('auth_tokens', JSON.stringify(result.tokens));
                        sessionStorage.setItem('streamer_tokens', JSON.stringify(result.tokens));
                        
                        // –°–ø–æ—Å–æ–± 3: window.name
                        window.name = JSON.stringify({
                            tokens: result.tokens,
                            user: result.user || null
                        });
                        
                        console.log('‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø–∞–Ω–µ–ª–∏ —Å—Ç—Ä–∏–º–µ—Ä–∞...');
                        window.location.href = 'streamer.html';
                    } else {
                        console.error('‚ùå –¢–æ–∫–µ–Ω—ã –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã:', result.error);
                        alert('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                    }
                } else {
                    console.error('‚ùå ElectronAPI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    alert('ElectronAPI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–ª–∏–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function openStreamerPanel() {
            console.log('üéÆ –ö–õ–ò–ö –ü–û –ü–ê–ù–ï–õ–ò –°–¢–†–ò–ú–ï–†–ê - –§–£–ù–ö–¶–ò–Ø –í–´–ó–í–ê–ù–ê!');
            
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω—ã –¥–ª—è –ø–∞–Ω–µ–ª–∏ —Å—Ç—Ä–∏–º–µ—Ä–∞ (—á–µ—Ä–µ–∑ Electron Store + localStorage)
                if (window.electronAPI && window.electronAPI.tokens) {
                    console.log('üîç –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è...');
                    const result = await window.electronAPI.tokens.getUser();
                    console.log('üîë ElectronAPI —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', result.success ? '–£–°–ü–ï–•' : '–û–®–ò–ë–ö–ê', result.error || '');
                    if (result.success && result.tokens) {
                        console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω—ã –≤—Å–µ–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏...');
                        
                        // –°–ø–æ—Å–æ–± 1: localStorage  
                        localStorage.setItem('auth_tokens', JSON.stringify(result.tokens));
                        localStorage.setItem('streamer_tokens', JSON.stringify(result.tokens));
                        
                        // –°–ø–æ—Å–æ–± 2: sessionStorage (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
                        sessionStorage.setItem('auth_tokens', JSON.stringify(result.tokens));
                        sessionStorage.setItem('streamer_tokens', JSON.stringify(result.tokens));
                        
                        // –°–ø–æ—Å–æ–± 3: window.name (–≤—ã–∂–∏–≤–∞–µ—Ç –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
                        window.name = JSON.stringify({
                            tokens: result.tokens,
                            user: result.user
                        });
                        
                        // –°–ø–æ—Å–æ–± 4: Electron Store (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
                        if (window.electronAPI && window.electronAPI.store) {
                            try {
                                await window.electronAPI.store.set('streamer_tokens', result.tokens);
                                await window.electronAPI.store.set('streamer_user', result.user);
                                console.log('üíæ –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ Electron Store');
                            } catch (storeError) {
                                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Electron Store:', storeError);
                            }
                        }
                        
                        if (result.user) {
                            console.log('üë§ –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', result.user.username || '–Ω–µ—Ç username');
                            localStorage.setItem('user', JSON.stringify(result.user));
                            localStorage.setItem('streamer_user', JSON.stringify(result.user));
                            sessionStorage.setItem('user', JSON.stringify(result.user));
                            sessionStorage.setItem('streamer_user', JSON.stringify(result.user));
                        }
                        
                        console.log('‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ (localStorage, sessionStorage, window.name)');
                    } else {
                        console.warn('‚ö†Ô∏è –ù–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                    }
                } else {
                    console.warn('‚ö†Ô∏è ElectronAPI.tokens –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ç—Ä–∏–º–µ—Ä–∞ (–≤ —Ç–æ–º –∂–µ –æ–∫–Ω–µ, –∫–∞–∫ –≤ Discord)
                window.location.href = 'streamer.html';
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ —Å—Ç—Ä–∏–º–µ—Ä–∞:', error);
                showStatus('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ —Å—Ç—Ä–∏–º–µ—Ä–∞', 'error');
            }
        }

        // üÜï –≠–¢–ê–ü 3.1: –§—É–Ω–∫—Ü–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –≤—ã–±–æ—Ä–∞ –æ–∫–Ω–∞
        let selectedWindow = null;
        let selectedMode = 'window';
        let availableWindows = [];

        async function showWindowSelectionDialog() {
            document.getElementById('window-selection-dialog').style.display = 'flex';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
            initializeModeSelection();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω –µ—Å–ª–∏ —Ä–µ–∂–∏–º "window"
            if (selectedMode === 'window') {
                await loadAvailableWindows();
            }
        }

        function hideWindowSelectionDialog() {
            document.getElementById('window-selection-dialog').style.display = 'none';
            selectedWindow = null;
            updateStartButton();
        }

        function initializeModeSelection() {
            const modeOptions = document.querySelectorAll('.mode-option');
            modeOptions.forEach(option => {
                option.addEventListener('click', () => selectMode(option.dataset.mode));
            });
            
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–±–∏—Ä–∞–µ–º window mode
            selectMode('window');
        }

        function selectMode(mode) {
            selectedMode = mode;
            selectedWindow = null;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI —Ä–µ–∂–∏–º–æ–≤
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.toggle('active', option.dataset.mode === mode);
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω
            const windowListContainer = document.getElementById('window-list-container');
            if (mode === 'window') {
                windowListContainer.style.display = 'block';
                loadAvailableWindows();
            } else {
                windowListContainer.style.display = 'none';
            }
            
            updateStartButton();
        }

        async function loadAvailableWindows() {
            const loadingEl = document.getElementById('windows-loading');
            const gridEl = document.getElementById('windows-grid');
            const errorEl = document.getElementById('windows-error');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loadingEl.style.display = 'flex';
            gridEl.style.display = 'none';
            errorEl.style.display = 'none';
            
            try {
                const response = await window.electronAPI.invoke('window:get-available');
                
                if (response.success && response.windows) {
                    availableWindows = response.windows;
                    renderWindowsGrid();
                    
                    loadingEl.style.display = 'none';
                    gridEl.style.display = 'grid';
                } else {
                    throw new Error(response.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–∫–æ–Ω:', error);
                
                loadingEl.style.display = 'none';
                errorEl.style.display = 'flex';
            }
        }

        function renderWindowsGrid() {
            const gridEl = document.getElementById('windows-grid');
            gridEl.innerHTML = '';
            
            if (availableWindows.length === 0) {
                gridEl.innerHTML = '<div class="empty-state"><p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–∫–æ–Ω</p></div>';
                return;
            }
            
            availableWindows.forEach(window => {
                const windowEl = document.createElement('div');
                windowEl.className = 'window-item';
                windowEl.dataset.windowId = window.id;
                
                windowEl.innerHTML = `
                    <img src="${window.thumbnail}" alt="${window.name}" class="window-thumbnail" onerror="this.style.display='none'">
                    <div class="window-info">
                        <h4>${window.name}</h4>
                        <p>${window.executableName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                    </div>
                    <div class="window-selected-indicator">‚úì</div>
                `;
                
                windowEl.addEventListener('click', () => selectWindow(window));
                gridEl.appendChild(windowEl);
            });
        }

        function selectWindow(window) {
            selectedWindow = window;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            document.querySelectorAll('.window-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.windowId === window.id);
            });
            
            updateStartButton();
        }

        function updateStartButton() {
            const startBtn = document.getElementById('start-setup-btn');
            const canStart = selectedMode === 'screen' || (selectedMode === 'window' && selectedWindow);
            
            startBtn.disabled = !canStart;
            
            if (selectedMode === 'screen') {
                startBtn.innerHTML = 'üñ•Ô∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —ç–∫—Ä–∞–Ω';
            } else if (selectedWindow) {
                startBtn.innerHTML = `ü™ü –ù–∞—Å—Ç—Ä–æ–∏—Ç—å "${selectedWindow.name}"`;
            } else {
                startBtn.innerHTML = '‚öôÔ∏è –ù–∞—á–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É';
            }
        }

        async function refreshWindowsList() {
            await loadAvailableWindows();
        }

        async function startOCRSetup() {
            try {
                if (selectedMode === 'screen') {
                    // –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                    await window.electronAPI.ocr.setupRegions();
                } else if (selectedMode === 'window' && selectedWindow) {
                    // –û–∫–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º - –ø–µ—Ä–µ–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
                    const context = {
                        mode: 'window',
                        targetWindow: selectedWindow
                    };
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–∫–Ω–æ –∫–∞–∫ —Ü–µ–ª—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                    try {
                        const setTargetResult = await window.electronAPI.monitor.setWindowTarget(selectedWindow);
                        
                        if (!setTargetResult.success) {
                            console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:', setTargetResult.error);
                        }
                    } catch (error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ü–µ–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:', error);
                    }
                    
                    await window.electronAPI.ocr.setupRegions(context);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–µ—Å—Å–∏–π
                    await window.electronAPI.invoke('window:save-selection', selectedWindow);
                } else {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    try {
                        await window.electronAPI.monitor.setScreenTarget();
                    } catch (error) {
                        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω:', error);
                    }
                }
                
                hideWindowSelectionDialog();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', error);
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: ' + error.message, 'error');
            }
        }

        // üéØ –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
        function toggleAdvancedSettings() {
            const content = document.getElementById('advanced-content');
            const button = document.getElementById('toggle-advanced');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                button.textContent = '‚ñ≤';
                loadCurrentSettings();
            } else {
                content.style.display = 'none';
                button.textContent = '‚ñº';
            }
        }

        async function loadCurrentSettings() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ StoreManager
                const delays = await window.electronAPI.store.get('triggerDelays', { fast: 0, precise: 2.2 });
                const settings = await window.electronAPI.store.get('triggerSettings', { 
                    cooldown: 15, 
                    confirmations: 2 
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                const preciseSlider = document.getElementById('preciseDelaySlider');
                const preciseValue = document.getElementById('preciseDelayValue');
                const cooldownSlider = document.getElementById('cooldownSlider');
                const cooldownValue = document.getElementById('cooldownValue');
                const confirmationsSlider = document.getElementById('confirmationsSlider');
                const confirmationsValue = document.getElementById('confirmationsValue');
                
                if (preciseSlider) {
                    preciseSlider.value = delays.precise || 2.2;
                    preciseValue.textContent = (delays.precise || 2.2) + '—Å';
                }
                
                if (cooldownSlider) {
                    cooldownSlider.value = settings.cooldown || 15;
                    cooldownValue.textContent = (settings.cooldown || 15) + '—Å';
                }
                
                if (confirmationsSlider) {
                    confirmationsSlider.value = settings.confirmations || 2;
                    confirmationsValue.textContent = settings.confirmations || 2;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–∫—Ä—ã—Ç–∏—è —Ä–∞–º–∫–∏ –∑–∞—Ö–≤–∞—Ç–∞
                const hideBorderEnabled = await window.electronAPI.store.get('hideCaptureborder', false);
                const hideBorderCheckbox = document.getElementById('hideBorderCheckbox');
                if (hideBorderCheckbox) {
                    hideBorderCheckbox.checked = hideBorderEnabled;
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }

        async function updatePreciseDelay(value) {
            try {
                const delays = await window.electronAPI.store.get('triggerDelays', { fast: 0, precise: 2.2 });
                delays.precise = parseFloat(value);
                await window.electronAPI.store.set('triggerDelays', delays);
                
                document.getElementById('preciseDelayValue').textContent = value + '—Å';
                showStatus(`–ó–∞–¥–µ—Ä–∂–∫–∞ —Ç–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞: ${value}—Å`, 'success');
                
                // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
                await restartMonitoringIfActive();
                
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏', 'error');
                console.error(error);
            }
        }

        async function updateCooldown(value) {
            try {
                const settings = await window.electronAPI.store.get('triggerSettings', { cooldown: 15, confirmations: 2 });
                settings.cooldown = parseInt(value);
                await window.electronAPI.store.set('triggerSettings', settings);
                
                document.getElementById('cooldownValue').textContent = value + '—Å';
                showStatus(`Cooldown –æ–±–Ω–æ–≤–ª–µ–Ω: ${value}—Å`, 'success');
                
                await restartMonitoringIfActive();
                
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è cooldown', 'error');
                console.error(error);
            }
        }

        async function updateConfirmations(value) {
            try {
                const settings = await window.electronAPI.store.get('triggerSettings', { cooldown: 15, confirmations: 2 });
                settings.confirmations = parseInt(value);
                await window.electronAPI.store.set('triggerSettings', settings);
                
                document.getElementById('confirmationsValue').textContent = value;
                showStatus(`–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: ${value}`, 'success');
                
                await restartMonitoringIfActive();
                
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π', 'error');
                console.error(error);
            }
        }

        // üñºÔ∏è –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫—Ä—ã—Ç–∏—è —Ä–∞–º–∫–∏ –∑–∞—Ö–≤–∞—Ç–∞
        async function updateHideBorder(enabled) {
            try {
                await window.electronAPI.store.set('hideCaptureborder', enabled);
                
                const status = enabled ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–æ—Ç–∫–ª—é—á–µ–Ω–æ';
                showStatus(`–°–∫—Ä—ã—Ç–∏–µ —Ä–∞–º–∫–∏ –∑–∞—Ö–≤–∞—Ç–∞ ${status}`, 'success');
                
                // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                await restartMonitoringIfActive();
                
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–º–∫–∏', 'error');
                console.error(error);
            }
        }

        async function resetToDefaults() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                try {
                    await window.electronAPI.store.set('triggerDelays', { fast: 0, precise: 2.2 });
                    await window.electronAPI.store.set('triggerSettings', { cooldown: 15, confirmations: 2 });
                    await window.electronAPI.store.set('hideCaptureborder', false); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ä–∞–º–∫–∏
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    loadCurrentSettings();
                    showStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é', 'success');
                    
                    await restartMonitoringIfActive();
                    
                } catch (error) {
                    showStatus('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
                    console.error(error);
                }
            }
        }

        async function restartMonitoringIfActive() {
            try {
                const status = await window.electronAPI.monitor.getStatus();
                if (status.isRunning) {
                    console.log('–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏...');
                    await window.electronAPI.monitor.restart('–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤');
                }
            } catch (error) {
                console.log('–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è');
            }
        }

        async function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                await window.electronAPI.auth.logout();
            }
        }

        async function toggleDeckWidget() {
            if (!lastPlayerData) {
                showStatus('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–µ', 'error');
                return;
            }
            await window.electronAPI.widget.toggle(lastPlayerData);
        }

        // UI —Ñ—É–Ω–∫—Ü–∏–∏
        function updateMonitoringUI() {
            const indicator = document.getElementById('status-indicator');
            const startBtn = document.getElementById('start-monitor');
            const stopBtn = document.getElementById('stop-monitor');
            
            if (isMonitoring) {
                indicator.classList.add('active');
                startBtn.disabled = true;
                stopBtn.disabled = false;
            } else {
                indicator.classList.remove('active');
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }

        function updateStats() {
            document.getElementById('battles-count').textContent = battlesCount;
            const successRate = battlesCount > 0 ? Math.round((successCount / battlesCount) * 100) : 0;
            document.getElementById('success-rate').textContent = `${successRate}%`;
        }

        async function toggleSearchMode() {
            const toggle = document.getElementById('search-mode-toggle');
            searchMode = toggle.checked ? 'precise' : 'fast';
            
            await window.electronAPI.settings.saveSearchMode(searchMode);
            
            updateModeUI();
            showStatus(`–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω ${searchMode === 'fast' ? '–±—ã—Å—Ç—Ä—ã–π' : '—Ç–æ—á–Ω—ã–π'} —Ä–µ–∂–∏–º`, 'success');
        }

        function updateModeUI() {
            const toggle = document.getElementById('search-mode-toggle');
            const indicator = document.getElementById('mode-indicator');
            const description = document.getElementById('mode-description');
            
            if (searchMode === 'precise') {
                toggle.checked = true;
                indicator.textContent = '–¢–æ—á–Ω—ã–π —Ä–µ–∂–∏–º';
                description.textContent = '–ü–æ–∏—Å–∫ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É + –∫–ª–∞–Ω—É';
            } else {
                toggle.checked = false;
                indicator.textContent = '–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º';
                description.textContent = '–ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É';
            }
        }

        function generateDeckHtml(deck) {
            if (!deck || !deck.cards || deck.cards.length === 0) {
                return '<div class="detail-item"><div class="detail-label">–ö–æ–ª–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div></div>';
            }

            const cardsHtml = deck.cards.map((card, index) => {
                const cardName = card.name || '–ö–∞—Ä—Ç–∞';

                // evolution_level: 0=–æ–±—ã—á–Ω–∞—è, 1=—ç–≤–æ–ª—é—Ü–∏—è, 2+=—á–µ–º–ø–∏–æ–Ω
                const evolutionLevel = card.evolution_level || 0;
                const isEvolution = evolutionLevel === 1 || card.is_evolution === true;
                const isHero = evolutionLevel >= 2;

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç display_icon_url -> –ø–æ level -> –æ–±—ã—á–Ω–∞—è
                let iconUrl = card.icon_url || '';
                if (card.display_icon_url) {
                    iconUrl = card.display_icon_url;
                } else if (isHero && card.hero_icon_url) {
                    iconUrl = card.hero_icon_url;
                } else if (isEvolution && card.evolution_icon_url) {
                    iconUrl = card.evolution_icon_url;
                }

                // CSS –∫–ª–∞—Å—Å—ã
                let classes = '';
                if (isHero) {
                    classes = 'hero';
                } else if (isEvolution) {
                    classes = 'evolution';
                }

                // –¢–∏–ø –¥–ª—è –¥–µ–±–∞–≥–∞
                const typeLabel = isHero ? ' (Hero)' : (isEvolution ? ' (Evolution)' : '');
                const debugTitle = `${cardName}${typeLabel} [Pos: ${index}]`;

                return `
                    <div class="deck-card-item ${classes}"
                        title="${debugTitle}"
                        data-evolution-level="${evolutionLevel}"
                        data-position="${index}">
                        <img src="${iconUrl}"
                            alt="${cardName}"
                            onerror="this.style.display='none'"
                            loading="lazy">
                    </div>
                `;
            }).join('');

            const averageElixir = deck.average_elixir ? deck.average_elixir.toFixed(1) : 'N/A';

            return `
                <div class="detail-item" style="grid-column: 1 / -1;">
                    <div class="detail-label">–ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ–ª–æ–¥–∞ (‚ö°${averageElixir})</div>
                    <div class="deck-cards-grid">
                        ${cardsHtml}
                    </div>
                </div>
            `;
        }

        function addResultCard(playerData) {
            const container = document.getElementById('results-container');
            
            const emptyState = container.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
            
            const player = playerData.player || {};
            const ocrResult = playerData.ocr_result || {};
            const decks = playerData.decks || [];
            const searchResult = playerData.search_result || {};
            
            const playerName = player.name || ocrResult.nickname || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
            const playerRating = player.rating || ocrResult.rating || 0;
            const playerClan = player.clan_name || '–ë–µ–∑ –∫–ª–∞–Ω–∞';
            const playerRank = player.rank || 'N/A';
            
            let deckInfo = '';
            if (decks && decks.length > 0) {
                const recentDeck = decks[0];
                if (recentDeck && !recentDeck.average_elixir && recentDeck.cards) {
                    const costs = recentDeck.cards.map(c => c.elixir_cost).filter(c => c !== null && c !== undefined);
                    recentDeck.average_elixir = costs.length > 0 ? (costs.reduce((a, b) => a + b, 0) / costs.length) : 0;
                }
                deckInfo = generateDeckHtml(recentDeck);
            }
            
            const searchStatus = playerData.success ? '‚úÖ –ù–∞–π–¥–µ–Ω' : '‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω';
            const searchMethod = searchResult.search_method || 'OCR';
            
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = `
                <div class="player-header">
                    <div class="player-name">${playerName}</div>
                    <div class="player-trophies"><img src="./assets/rating.png" class="rating-icon" alt="rating"> ${playerRating.toLocaleString()}</div>
                </div>
                <div class="player-details">
                    <div class="detail-item">
                        <div class="detail-label">–ö–ª–∞–Ω</div>
                        <div class="detail-value">${playerClan}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">–†–∞–Ω–≥</div>
                        <div class="detail-value">#${playerRank.toLocaleString()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">–°—Ç–∞—Ç—É—Å –ø–æ–∏—Å–∫–∞</div>
                        <div class="detail-value">${searchStatus}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">–ú–µ—Ç–æ–¥</div>
                        <div class="detail-value">${searchMethod}</div>
                    </div>
                    ${deckInfo}
                </div>
                <div class="timestamp">${new Date().toLocaleTimeString()}</div>
            `;
            
            if (container.firstChild) {
                container.insertBefore(card, container.firstChild);
            } else {
                container.appendChild(card);
            }
            
            const cards = container.querySelectorAll('.result-card');
            if (cards.length > 20) {
                cards[cards.length - 1].remove();
            }
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.createElement('div');
            statusEl.className = `status-message ${type}`;
            statusEl.textContent = message;
            document.body.appendChild(statusEl);
            
            setTimeout(() => {
                statusEl.style.opacity = '0';
                statusEl.style.transform = 'translateX(100px)';
                setTimeout(() => statusEl.remove(), 300);
            }, 3000);
        }

        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            if (show) {
                overlay.classList.add('active');
            } else {
                overlay.classList.remove('active');
            }
        }

        // üöÄ –ü—Ä–µ–º–∏—É–º —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π v2.0
        let updateInProgress = false;
        let downloadInProgress = false;
        let currentUpdateInfo = null;
        let downloadedFilePath = null;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        async function checkForUpdates() {
            if (updateInProgress) return;
            
            updateInProgress = true;
            updateStatusUI('checking', 'üîç', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...');
            
            const checkBtn = document.getElementById('check-update-btn');
            checkBtn.disabled = true;
            
            try {
                const result = await window.electronAPI.update.checkSimple();
                
                if (result.success) {
                    if (result.hasUpdate) {
                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ!
                        currentUpdateInfo = result;
                        updateStatusUI('available', '‚ú®', `–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ${result.latestVersion}!`);
                        showUpdateInfo(result);
                        showStatus(`–ù–∞–π–¥–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ ${result.latestVersion}!`, 'success');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –Ω–æ–≤—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
                        setTimeout(() => showAdvancedUpdateModal(result), 1000);
                        
                    } else {
                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–µ—Ç
                        updateStatusUI('up-to-date', '‚úÖ', '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ');
                        showStatus('–£ –≤–∞—Å –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è!', 'success');
                        
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                        setTimeout(() => {
                            updateStatusUI('ready', '‚è≥', '–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ');
                        }, 3000);
                    }
                } else {
                    // –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
                    updateStatusUI('error', '‚ùå', result.error || '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏');
                    showStatus(`–û—à–∏–±–∫–∞: ${result.error}`, 'error');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        updateStatusUI('ready', '‚è≥', '–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ');
                    }, 5000);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:', error);
                updateStatusUI('error', '‚ùå', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                showStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            } finally {
                updateInProgress = false;
                checkBtn.disabled = false;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Å—Ç–∞—Ç—É—Å–∞
        function updateStatusUI(status, icon, text) {
            const statusEl = document.getElementById('update-status');
            const iconEl = document.getElementById('status-icon');
            const textEl = document.getElementById('status-text');
            
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
            statusEl.className = 'update-status';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å
            if (status !== 'ready') {
                statusEl.classList.add(status);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            iconEl.textContent = icon;
            textEl.textContent = text;
        }

        // –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
        function showUpdateInfo(updateInfo) {
            const infoEl = document.getElementById('update-info');
            const newVersionEl = document.getElementById('new-version');
            const releaseDateEl = document.getElementById('release-date');
            const fileSizeEl = document.getElementById('file-size');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            newVersionEl.textContent = `–í–µ—Ä—Å–∏—è ${updateInfo.latestVersion}`;
            
            if (updateInfo.releaseDate) {
                const date = new Date(updateInfo.releaseDate).toLocaleDateString('ru-RU');
                releaseDateEl.textContent = `–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: ${date}`;
            } else {
                releaseDateEl.textContent = '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: –°–µ–≥–æ–¥–Ω—è';
            }
            
            if (updateInfo.fileSize) {
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥
                const sizeInMB = (parseInt(updateInfo.fileSize) / 1024 / 1024).toFixed(1);
                fileSizeEl.textContent = `–†–∞–∑–º–µ—Ä: ${sizeInMB} MB`;
            } else {
                fileSizeEl.textContent = '–†–∞–∑–º–µ—Ä: ~150 MB';
            }
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏
            const oldButtons = infoEl.querySelectorAll('.download-button, .button');
            oldButtons.forEach(btn => btn.remove());
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º URL
            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'button download-button';
            downloadBtn.innerHTML = `
                <span class="button-icon">üì•</span>
                <span class="button-text">–°–∫–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
            `;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º URL –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
            let openUrl = updateInfo.downloadUrl;
            if (!openUrl) {
                // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å URL –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const serverUrl = 'http://130.61.118.215:8080';
                if (updateInfo.latestVersion) {
                    openUrl = `${serverUrl}/api/app/download/${updateInfo.latestVersion}/installer`;
                } else {
                    openUrl = `${serverUrl}/admin`;
                }
            } else if (openUrl.startsWith('/')) {
                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ URL –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å /, –¥–æ–±–∞–≤–ª—è–µ–º serverUrl
                const serverUrl = 'http://130.61.118.215:8080';
                openUrl = serverUrl + openUrl;
            }
            
            console.log('üîó URL –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è:', openUrl);
            
            downloadBtn.onclick = () => {
                console.log('üíÜ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è, URL:', openUrl);
                
                // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–±–æ—Ä: —Å–∫–∞—á–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                const choice = confirm('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:\n\n–û–ö - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ\n–û—Ç–º–µ–Ω–∞ - –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
                
                if (choice) {
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                    downloadUpdate('installer');
                } else {
                    // –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                    openUpdatePage(openUrl);
                }
            };
            
            infoEl.appendChild(downloadBtn);
            infoEl.style.display = 'block';
        }

        // –ö—Ä–∞—Å–∏–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function showUpdateModal(updateInfo) {
            const modal = document.createElement('div');
            modal.className = 'update-modal';
            modal.innerHTML = `
                <div class="update-modal-content">
                    <h2 class="modal-title">üéÜ –ù–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!</h2>
                    <div class="modal-version">–í–µ—Ä—Å–∏—è ${updateInfo.latestVersion}</div>
                    <div class="modal-description">
                        –î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è Snipe Client! 
                        –ù–∞–∂–º–∏—Ç–µ "–°–∫–∞—á–∞—Ç—å", —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é.
                        <br><br>
                        <strong>–†–∞–∑–º–µ—Ä:</strong> ${updateInfo.fileSize || '–û–∫–æ–ª–æ 150MB'}<br>
                        <strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</strong> ${new Date(updateInfo.publishedAt).toLocaleDateString('ru-RU')}
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-button primary" onclick="openUpdatePage('${updateInfo.releaseUrl}'); closeUpdateModal()">
                            üì• –°–∫–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                        </button>
                        <button class="modal-button secondary" onclick="closeUpdateModal()">
                            üï∞Ô∏è –ü–æ–∑–∂–µ
                        </button>
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.body.appendChild(modal);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            setTimeout(() => modal.classList.add('active'), 100);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeUpdateModal();
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            window.currentUpdateModal = modal;
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeUpdateModal() {
            const modal = window.currentUpdateModal;
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => {
                    modal.remove();
                    window.currentUpdateModal = null;
                }, 300);
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        async function openUpdatePage(url) {
            try {
                console.log('üåê –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å URL:', url);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL
                if (!url || typeof url !== 'string') {
                    console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL:', url);
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å URL –∏–∑ —Ç–µ–∫—É—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                    if (currentUpdateInfo && currentUpdateInfo.downloadUrl) {
                        url = currentUpdateInfo.downloadUrl;
                        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ URL –ø–æ–ª–Ω—ã–π
                        if (url.startsWith('/')) {
                            const serverUrl = 'http://130.61.118.215:8080';
                            url = serverUrl + url;
                        }
                        console.log('üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º downloadUrl –∏–∑ currentUpdateInfo:', url);
                    } else {
                        // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ—Å—Ç—Ä–æ–∏—Ç—å URL –≤—Ä—É—á–Ω—É—é
                        const serverUrl = 'http://130.61.118.215:8080'; // –§–æ–ª–±—ç–∫ URL
                        url = `${serverUrl}/admin`;
                        console.log('üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ–ª–±—ç–∫ URL:', url);
                    }
                }
                
                const result = await window.electronAPI.update.openRelease(url);
                
                if (result.success) {
                    showStatus('–°—Å—ã–ª–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ', 'success');
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Å—ã–ª–∫–∏:', result.error);
                    showStatus(`–û—à–∏–±–∫–∞: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è URL:', error);
                showStatus('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Å—ã–ª–∫–∏', 'error');
            }
        }

        // üì• –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        async function downloadUpdate(downloadType = 'installer') {
            console.log('üì• downloadUpdate –≤—ã–∑–≤–∞–Ω–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º:', downloadType);
            
            if (downloadInProgress || !currentUpdateInfo) {
                console.log('‚ö†Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞: downloadInProgress=', downloadInProgress, 'currentUpdateInfo=', !!currentUpdateInfo);
                return;
            }
            
            downloadInProgress = true;
            updateStatusUI('downloading', 'üì•', '–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è...');
            showStatus('–ù–∞—á–∏–Ω–∞–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è...', 'info');
            
            console.log('üì• –ù–∞—á–∏–Ω–∞–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ...');
            
            try {
                console.log('üìû –í—ã–∑—ã–≤–∞–µ–º window.electronAPI.update.download...');
                const result = await window.electronAPI.update.download(downloadType);
                
                console.log('üìù –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                
                if (result.success) {
                    downloadedFilePath = result.downloadPath;
                    updateStatusUI('downloaded', '‚úÖ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–∞—á–∞–Ω–æ!');
                    showStatus('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω–æ!', 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
                    showInstallButton(result);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
                    setTimeout(() => showInstallModal(result), 1000);
                    
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:', result.error);
                    updateStatusUI('error', '‚ùå', '–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                    showStatus(`–û—à–∏–±–∫–∞: ${result.error}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ):', error);
                updateStatusUI('error', '‚ùå', '–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                showStatus('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
            } finally {
                downloadInProgress = false;
                console.log('üèÅ downloadUpdate –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            }
        }

        // üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        async function installUpdate() {
            if (!downloadedFilePath) {
                showStatus('–ù–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ', 'error');
                return;
            }
            
            try {
                const result = await window.electronAPI.update.install(downloadedFilePath);
                
                if (result.success) {
                    showStatus('–£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç–æ...', 'success');
                } else {
                    showStatus(`–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: ${result.error}`, 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:', error);
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞', 'error');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
        function showInstallButton(downloadResult) {
            const infoEl = document.getElementById('update-info');
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const oldDownloadBtn = infoEl.querySelector('.download-button');
            if (oldDownloadBtn) {
                oldDownloadBtn.remove();
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            const installBtn = document.createElement('button');
            installBtn.className = 'button update-button';
            installBtn.style.background = 'linear-gradient(135deg, var(--success), #059669)';
            installBtn.innerHTML = `
                <span class="button-icon">üöÄ</span>
                <span class="button-text">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
            `;
            installBtn.onclick = installUpdate;
            
            // –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏ –∑–∞–≥—Ä—É–∑–æ–∫
            const openFolderBtn = document.createElement('button');
            openFolderBtn.className = 'button secondary';
            openFolderBtn.style.marginTop = '10px';
            openFolderBtn.innerHTML = `
                <span class="button-icon">üìÅ</span>
                <span class="button-text">–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É</span>
            `;
            openFolderBtn.onclick = () => window.electronAPI.update.openDownloads();
            
            infoEl.appendChild(installBtn);
            infoEl.appendChild(openFolderBtn);
        }

        // –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –æ–ø—Ü–∏—è–º–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        function showAdvancedUpdateModal(updateInfo) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º URL –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
            let browserUrl = updateInfo.downloadUrl;
            if (!browserUrl) {
                const serverUrl = 'http://130.61.118.215:8080';
                if (updateInfo.latestVersion) {
                    browserUrl = `${serverUrl}/api/app/download/${updateInfo.latestVersion}/installer`;
                } else {
                    browserUrl = `${serverUrl}/admin`;
                }
            } else if (browserUrl.startsWith('/')) {
                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ URL –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å /, –¥–æ–±–∞–≤–ª—è–µ–º serverUrl
                const serverUrl = 'http://130.61.118.215:8080';
                browserUrl = serverUrl + browserUrl;
            }
            
            console.log('üåê URL –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞:', browserUrl);
            
            const modal = document.createElement('div');
            modal.className = 'update-modal';
            modal.innerHTML = `
                <div class="update-modal-content">
                    <h2 class="modal-title">üéÜ –ù–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!</h2>
                    <div class="modal-version">–í–µ—Ä—Å–∏—è ${updateInfo.latestVersion}</div>
                    <div class="modal-description">
                        –î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è Snipe Client! 
                        –í—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—ë –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∏–∫–æ–≤.
                        <br><br>
                        <strong>–†–∞–∑–º–µ—Ä:</strong> ${updateInfo.fileSize ? (parseInt(updateInfo.fileSize) / 1024 / 1024).toFixed(1) + ' MB' : '–û–∫–æ–ª–æ 150MB'}<br>
                        <strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</strong> ${updateInfo.releaseDate ? new Date(updateInfo.releaseDate).toLocaleDateString('ru-RU') : '–°–µ–≥–æ–¥–Ω—è'}
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-button primary" onclick="downloadUpdate('installer'); closeUpdateModal()">
                            üì• –°–∫–∞—á–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                        </button>
                        <button class="modal-button secondary" onclick="openUpdatePage('${browserUrl}'); closeUpdateModal()">
                            üåê –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                        </button>
                        <button class="modal-button secondary" onclick="closeUpdateModal()">
                            üï∞Ô∏è –ü–æ–∑–∂–µ
                        </button>
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.body.appendChild(modal);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            setTimeout(() => modal.classList.add('active'), 100);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeUpdateModal();
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            window.currentUpdateModal = modal;
        }

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
        function showInstallModal(downloadResult) {
            const modal = document.createElement('div');
            modal.className = 'update-modal';
            modal.innerHTML = `
                <div class="update-modal-content">
                    <h2 class="modal-title">üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!</h2>
                    <div class="modal-version">–í–µ—Ä—Å–∏—è ${downloadResult.version}</div>
                    <div class="modal-description">
                        –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ.
                        <br><br>
                        –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫,
                        –∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç–æ.
                        <br><br>
                        <strong>–§–∞–π–ª:</strong> ${downloadResult.downloadPath.split('\\').pop()}<br>
                        <strong>–†–∞–∑–º–µ—Ä:</strong> ${(downloadResult.fileSize / 1024 / 1024).toFixed(1)} MB
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-button primary" onclick="installUpdate(); closeUpdateModal()">
                            üöÄ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–π—á–∞—Å
                        </button>
                        <button class="modal-button secondary" onclick="window.electronAPI.update.openDownloads(); closeUpdateModal()">
                            üìÅ –û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É
                        </button>
                        <button class="modal-button secondary" onclick="closeUpdateModal()">
                            üï∞Ô∏è –ü–æ–∑–∂–µ
                        </button>
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.body.appendChild(modal);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            setTimeout(() => modal.classList.add('active'), 100);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeUpdateModal();
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            window.currentUpdateModal = modal;
        }

        // üöÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        window.electronAPI.on('update-download-progress', (progress) => {
            updateDownloadProgress(progress);
        });
        
        window.electronAPI.on('update-info-changed', (info) => {
            currentUpdateInfo = info;
            if (info && info.hasUpdate) {
                updateStatusUI('available', '‚ú®', `–í–µ—Ä—Å–∏—è ${info.latestVersion} –¥–æ—Å—Ç—É–ø–Ω–∞!`);
                showUpdateInfo(info);
            }
        });
        
        window.electronAPI.on('update-downloaded', (result) => {
            downloadedFilePath = result.downloadPath;
            updateStatusUI('downloaded', '‚úÖ', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–∞—á–∞–Ω–æ!');
            showInstallButton(result);
            showStatus('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ!', 'success');
        });
        
        window.electronAPI.on('update-error', (error) => {
            updateStatusUI('error', '‚ùå', '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
            showStatus(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error}`, 'error');
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        function updateDownloadProgress(progress) {
            const statusText = document.getElementById('status-text');
            const statusIcon = document.getElementById('status-icon');
            
            if (progress.percent !== undefined) {
                statusText.textContent = `–°–∫–∞—á–∏–≤–∞–Ω–∏–µ... ${progress.percent}%`;
                statusIcon.textContent = 'üì•';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                let progressBar = document.getElementById('download-progress');
                if (!progressBar) {
                    progressBar = document.createElement('div');
                    progressBar.id = 'download-progress';
                    progressBar.style.cssText = `
                        width: 100%;
                        height: 4px;
                        background: var(--bg-primary);
                        border-radius: 2px;
                        margin-top: 8px;
                        overflow: hidden;
                    `;
                    
                    const progressFill = document.createElement('div');
                    progressFill.id = 'progress-fill';
                    progressFill.style.cssText = `
                        height: 100%;
                        background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
                        border-radius: 2px;
                        transition: width 0.3s ease;
                        width: 0%;
                    `;
                    
                    progressBar.appendChild(progressFill);
                    document.getElementById('update-status').appendChild(progressBar);
                }
                
                const progressFill = document.getElementById('progress-fill');
                if (progressFill) {
                    progressFill.style.width = progress.percent + '%';
                }
                
                // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∫–æ–≥–¥–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                if (progress.percent >= 100) {
                    setTimeout(() => {
                        if (progressBar) {
                            progressBar.remove();
                        }
                    }, 1000);
                }
            }
        }
        async function initializeVersion() {
            try {
                const version = await window.electronAPI.app.getVersion();
                document.getElementById('version-display').textContent = `v${version}`;
                console.log(`üöÄ Clash Royale OCR v${version} - –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∞–∫—Ç–∏–≤–Ω–∞`);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏:', error);
                document.getElementById('version-display').textContent = '–û—à–∏–±–∫–∞';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        async function autoCheckUpdates() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
            setTimeout(async () => {
                try {
                    console.log('üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...');
                    
                    const result = await window.electronAPI.update.checkSimple();
                    
                    if (result.success && result.hasUpdate) {
                        // –ò–ó–ú–ï–ù–ò–õ–ò: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –≤–º–µ—Å—Ç–æ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        currentUpdateInfo = result;
                        updateStatusUI('available', '‚ú®', `–î–æ—Å—Ç—É–ø–Ω–∞ –≤–µ—Ä—Å–∏—è ${result.latestVersion}!`);
                        showUpdateInfo(result);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–ª—å—à–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                        setTimeout(() => {
                            showAdvancedUpdateModal(result);
                        }, 2000);
                        
                        console.log(`‚ú® –ù–∞–π–¥–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ ${result.latestVersion}`);
                    } else {
                        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ');
                    }
                } catch (error) {
                    console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∏:', error.message);
                }
            }, 5000);
        }

        // –ö–ª–∞–≤–∏—à–∞ ESC –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && window.currentUpdateModal) {
                closeUpdateModal();
            }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        
        // üåê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        async function initializeServer() {
            try {
                const result = await window.electronAPI.server.getCurrent();
                if (result.success) {
                    currentServerMode = result.server.mode;
                    updateServerUI(result.server.mode, result.server.available ? 'connected' : 'error');
                    updateTestModeIndicator(result.server.mode === 'test');
                    
                    console.log(`üåê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Ä–µ–∂–∏–º ${result.server.mode}, —Å—Ç–∞—Ç—É—Å: ${result.server.available ? '–ø–æ–¥–∫–ª—é—á–µ–Ω' : '–æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:', error);
                updateServerUI('global', 'error');
            }
        }
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)
        setInterval(checkServerConnection, 30000);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(() => {
            initializeServer();
            initializeVersion();
            autoCheckUpdates();
        }, 1000);
    </script>

    <!-- üÜï –≠–¢–ê–ü 3.1: –î–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –æ–∫–Ω–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OCR –æ–±–ª–∞—Å—Ç–µ–π -->
    <div id="window-selection-dialog" class="window-dialog-overlay" style="display: none;">
        <div class="window-dialog">
            <div class="window-dialog-header">
                <h2>ü™ü –í—ã–±–æ—Ä –æ–∫–Ω–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <button class="close-button" onclick="hideWindowSelectionDialog()">‚úï</button>
            </div>
            
            <div class="window-dialog-content">
                <div class="mode-selection">
                    <div class="mode-option active" data-mode="window">
                        <div class="mode-icon">ü™ü</div>
                        <div class="mode-info">
                            <h3>–û–∫–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
                            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—Å—Ç–µ–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–∫–Ω–∞</p>
                        </div>
                    </div>
                    <div class="mode-option" data-mode="screen">
                        <div class="mode-icon">üñ•Ô∏è</div>
                        <div class="mode-info">
                            <h3>–í–µ—Å—å —ç–∫—Ä–∞–Ω</h3>
                            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—Å—Ç–µ–π –¥–ª—è –≤—Å–µ–≥–æ —ç–∫—Ä–∞–Ω–∞</p>
                        </div>
                    </div>
                </div>

                <div id="window-list-container" class="window-list-container">
                    <div class="loading-spinner" id="windows-loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω...</p>
                    </div>
                    <div id="windows-grid" class="windows-grid" style="display: none;"></div>
                    <div id="windows-error" class="windows-error" style="display: none;">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω</p>
                        <button class="button small" onclick="refreshWindowsList()">üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <div class="window-dialog-footer">
                <button class="button secondary" onclick="hideWindowSelectionDialog()">–û—Ç–º–µ–Ω–∞</button>
                <button class="button primary" id="start-setup-btn" onclick="startOCRSetup()" disabled>
                    ‚öôÔ∏è –ù–∞—á–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
                </button>
            </div>
        </div>
    </div>

</body>
</html>